## ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆã¨å®Ÿè£…æ‰‹é †ï¼ˆWorkers å˜ä¸€ãƒ›ã‚¹ãƒˆæ–¹å¼ï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€1 ã¤ã® Cloudflare Workers ä¸Šã§ã€ŒReact ã®é™çš„é…ä¿¡ã€ã€ŒHono ãƒ™ãƒ¼ã‚¹ã® APIã€ã€ŒDurable Objectsï¼ˆDOï¼‰ã€ã‚’åŒå±…ã•ã›ã€åŒä¸€ã‚ªãƒªã‚¸ãƒ³ã§ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‹ã¤ã‚·ãƒ³ãƒ—ãƒ«ã«é‹ç”¨ã—ã¾ã™ã€‚ä»•æ§˜ã¯ `docs/å…¨å“¡ä¸€è‡´ã‚²ãƒ¼ãƒ .md` ã«æº–æ‹ ã—ã¾ã™ã€‚

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆæ¡ˆï¼‰

```
/src
	/client               # Reactï¼ˆVite, tailwind, GSAPï¼‰
		/pages
		/components
		/lib/api.ts
		main.tsx
		index.html
	/server               # Hono + Durable Objectsï¼ˆAPI ã¨ WSï¼‰
		index.ts            # Hono ã‚¨ãƒ³ãƒˆãƒª
		/routes
			rooms.ts          # REST/WS ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
		/do
			RoomDurable.ts    # Durable Object å®Ÿè£…
	/shared               # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ/ã‚µãƒ¼ãƒãƒ¼å…±é€šã®å‹
		types.ts            # docs ã®å‹ã‚’å³å¯†ã«åæ˜ 

wrangler.toml           # DO ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨é™çš„ã‚¢ã‚»ãƒƒãƒˆé…ä¿¡è¨­å®š
```

### é–‹ç™ºãƒ•ãƒ­ãƒ¼

1. Vite ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚’é–‹ç™ºã€Wrangler dev ã§ API/DO ã‚’èµ·å‹•
2. é–‹ç™ºä¸­ã¯ assets.dev_server ã§ Vite(5173) ã¸ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·
3. æœ¬ç•ªã¯ `vite build` ã§ `dist/client` ã‚’ç”Ÿæˆã—ã€Workers ã® assets ã¨ã—ã¦é…ä¿¡

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆä¾‹ï¼‰

- dev: `wrangler dev`ï¼ˆassets.dev_server ã§ Vite ã«å§”è­²ï¼‰
- dev:client: `vite`
- build:client: `vite build`
- deploy: `wrangler deploy`

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹é‡

- é™çš„: `/` ãŠã‚ˆã³ `/assets/*` ã¯ assets ã‹ã‚‰é…ä¿¡
- API: `/api/*` ã«é›†ç´„ï¼ˆ`docs/å…¨å“¡ä¸€è‡´ã‚²ãƒ¼ãƒ .md` ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«æº–æ‹ ï¼‰
- WS: `/ws/:id` ã§ DO ã«æ¥ç¶šã—ã€ç¾çŠ¶æ…‹ã®å³æ™‚é€ä¿¡ã¨ä»¥å¾Œã®æ›´æ–°é…ä¿¡

### èªå¯

- GM æ“ä½œã¯ `gmToken` å¿…é ˆï¼ˆãƒ«ãƒ¼ãƒ ä½œæˆæ™‚ã«æ‰•ã„å‡ºã—ã€LocalStorage ã«ä¿æŒï¼‰
- DO å´ã§ `gmId` ã¨ `gmToken` ã®æ•´åˆã‚’æ¤œè¨¼

### æ°¸ç¶šåŒ–

- ãƒ«ãƒ¼ãƒ å†…ã®å…¨çŠ¶æ…‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã€è¨­å®šã€é€²è¡ŒçŠ¶æ³ï¼‰ã¯ DO ã®ãƒ¡ãƒ¢ãƒªä¸Šã§ç®¡ç†
- ãƒ«ãƒ¼ãƒ çµ‚äº†ã‚„è§£æ•£ã§çŠ¶æ…‹ã¯ç ´æ£„ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã® put ã¯è¡Œã‚ãªã„ï¼‰

---

## Cloudflare è¨­å®šä¾‹ï¼ˆwrangler.tomlï¼‰

```toml
name = "unanimous-game"
main = "src/server/index.ts"
compatibility_date = "2024-06-20"

[assets]
# React Router ã®ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’é…ä¿¡ï¼ˆreact-router build å¾Œã®å‡ºåŠ›ï¼‰
directory = "src/client/build/client"
binding = "ASSETS"

[[durable_objects.bindings]]
name = "ROOM_DURABLE"
class_name = "RoomDurable"

[observability]
logs = { enabled = true }
```

è£œè¶³

- wrangler v4 ã§ã¯ `assets.dev_server` ã¯éæ¨å¥¨ã®ãŸã‚æœªä½¿ç”¨ã€‚é–‹ç™ºä¸­ã¯ `npm run dev:client`ï¼ˆViteï¼‰ã¨ `npm run dev`ï¼ˆWorkersï¼‰ã‚’ä½µç”¨ã—ã€å¿…è¦ã«å¿œã˜ã¦ `npm run build:client` ã‚’å®Ÿè¡Œã—ã¦ã‚¢ã‚»ãƒƒãƒˆã‚’æ›´æ–°ã™ã‚‹ã€‚
- Workers ä¸Šã® SSR ã¯ Node çµ„ã¿è¾¼ã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆfs/path/streamï¼‰ã‚’å«ã‚€ãŸã‚ `@react-router/node` ãŒè§£æ±ºã§ããšã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ SPA ãƒ¢ãƒ¼ãƒ‰ï¼ˆ`src/client/react-router.config.ts` ã® `ssr:false`ï¼‰ã§é…ä¿¡ã—ã€æœªãƒãƒƒãƒã¯ `index.html` ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹æ§‹æˆã«å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚

---

## å…±æœ‰å‹ï¼ˆ`src/shared/types.ts`ï¼‰

```ts
export type User = {
  id: string;
  name: string;
  icon: string;
  isGM: boolean;
};

export type RoomSettings = {
  topicMode: "gm" | "all";
  winCondition:
    | { type: "count"; value: number }
    | { type: "consecutive"; value: number }
    | { type: "none" };
};

export type Answer = {
  userId: string;
  value: string;
  submittedAt: number;
};

export type Round = {
  id: string;
  topic: string;
  setterId: string;
  answers: Answer[];
  result: "unopened" | "opened";
  unanimous: boolean | null;
};

export type Room = {
  id: string; // 4æ¡ç•ªå·
  gmId: string;
  users: User[];
  settings: RoomSettings;
  status: "waiting" | "playing" | "finished";
  rounds: Round[];
};
```

### å®Ÿè£…å„ªå…ˆåº¦

**Phase 1: æœ€å°ãƒ—ãƒ¬ã‚¤å¯èƒ½ç‰ˆ** âœ… **å®Œäº†**

1. âœ… ã‚²ãƒ¼ãƒ é–‹å§‹æ©Ÿèƒ½
2. âœ… ãƒ©ã‚¦ãƒ³ãƒ‰ä½œæˆãƒ»ãŠé¡Œè¨­å®š
3. âœ… å›ç­”é€ä¿¡ãƒ»ã‚ªãƒ¼ãƒ—ãƒ³
4. âœ… åŸºæœ¬çš„ãªçµæœåˆ¤å®š

**Phase 2: ã‚²ãƒ¼ãƒ ä½“é¨“ã®å‘ä¸Š** âœ… **å®Œäº†**

1. âœ… å‹åˆ©æ¡ä»¶åˆ¤å®š
2. âœ… æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰è‡ªå‹•ç”Ÿæˆ
3. âœ… é€²è¡ŒçŠ¶æ³è¡¨ç¤º

**Phase 3: æ¼”å‡ºãƒ»UX å¼·åŒ–** ğŸ”„ **é€²è¡Œä¸­**

1. ğŸ”„ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
   - ãƒ©ã‚¦ãƒ³ãƒ‰çµæœç™ºè¡¨æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
   - ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã®å‹åˆ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
   - å›ç­”çŠ¶æ³ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
2. âœ… ã‚¨ãƒ©ãƒ¼å‡¦ç†å¼·åŒ–ï¼ˆåŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯å®Ÿè£…æ¸ˆã¿ï¼‰
3. âœ… å†æ¥ç¶šå‡¦ç†ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªå†æ¥ç¶šå‡¦ç†ã¯å®Ÿè£…æ¸ˆã¿ï¼‰
4. âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆExpanded ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã‚‹ 800px å¹…åˆ¶é™å¯¾å¿œæ¸ˆã¿ï¼‰

**Phase 4: æ–°æ©Ÿèƒ½ãƒ»ä½“é¨“å‘ä¸Š** ğŸ†• **æ–°è¦è¿½åŠ **

1. ğŸ”„ UI/UX æ”¹å–„
   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®æ”¹å–„
   - æ“ä½œãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å¼·åŒ–
   - å‚åŠ è€…ã®å‹•ä½œçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
2. ğŸ“‹ ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½å¼·åŒ–ï¼ˆãƒ«ãƒ¼ãƒ ç•ªå·ã‚³ãƒ”ãƒ¼ã¯å®Ÿè£…æ¸ˆã¿ï¼‰
3. ğŸ® ã‚²ãƒ¼ãƒ ä½“é¨“ã®å‘ä¸Š
   - ç‰¹æ®Šã‚¢ã‚¤ã‚³ãƒ³æ©Ÿèƒ½ã®æ‹¡å¼µ
   - ã‚µã‚¦ãƒ³ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
   - çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º
4. ğŸ”§ é–‹ç™ºè€…ä½“é¨“ãƒ»ä¿å®ˆæ€§
   - TypeScript å‹å®‰å…¨æ€§ã®å¼·åŒ–
   - ãƒ†ã‚¹ãƒˆã®è¿½åŠ 
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼

1. DO ã®å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å˜ä½“ã§ãƒ†ã‚¹ãƒˆ
2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®çŠ¶æ…‹ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
3. WebSocket ã‚¤ãƒ™ãƒ³ãƒˆã®é€å—ä¿¡ãƒ†ã‚¹ãƒˆ
4. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®å‹•ä½œç¢ºèª
5. è¤‡æ•°ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®åŒæ™‚ãƒ—ãƒ¬ã‚¤ãƒ†ã‚¹ãƒˆ

## icon ã¯ã“ã“

https://iconbu.com/info
