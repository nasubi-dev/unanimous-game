## パクリ元
[全員一致ゲームをアプリで遊ぶ方法 - どこパ公式サイト](https://dokopa.com/zennin-icchi/)

## 必要要件
- ルーム作成機能
- Webで動作
- スマホファースト
- R/Wが多くても耐えられるSaaS
- ユーザー情報は永続保存しない（ルーム内でのみ一時的に管理 LocalStorageに保存し､アクセス時に再度呼び出す）
- ルームごとの状態管理はCloudflare Durable Objectsのみで完結
- ルーム作成時にDurable Objectを生成し、参加者はローカルで入力した情報をルームに登録
- ルーム内の全状態（ユーザー、設定、進行状況）はDurable Objectのメモリ上で管理
- ゲーム終了やルーム解散で状態は破棄

## 技術選定
- React
- tailwindcss
- GSAP
- hono
- Cloudflare
  - Durable Objects
  - Workers


## ユースケース
1. アクセスしたときに名前を入力
2. ランダムなIconが設定される
3. GMがルームを立てる｡4桁の番号が発行される
4. ゲストは番号を入力
5. ルーム設定
	1. お題: GMが決める or 全員一周する
	2. 勝利条件: n回一致クリア or n回連続一致 or 勝利条件なし
6. GMがスタートを押すと開始
7. お題設定者は用意されたもの(リロール可能) or 自分でテキストを打ち設定
8. 全員が回答終了またはGMが回答締切 → GMが回答オープン
9. 全員で一致したか相談 → 全員一致 or 全員一致せずを選択
10. 6 - 9を繰り返す
11. クリアしたらいい感じのエフェクト

## ページ構成
- トップページ(ちゅーとりある) `/`
- ルーム作成･参加ページ `/room`
- ゲーム進行ページ `/game`

## 型定義
```ts
type User = {
  id: string;
  name: string;
  icon: string;
  isGM: boolean;
};

type Room = {
  id: string; // 4桁番号
  gmId: string;
  users: User[];
  settings: RoomSettings;
  status: 'waiting' | 'playing' | 'finished';
  rounds: Round[];
};

type RoomSettings = {
  topicMode: 'gm' | 'all';
  winCondition: 
    | { type: 'count'; value: number } // n回一致クリア
    | { type: 'consecutive'; value: number } // n回連続一致
    | { type: 'none' }; // 勝利条件なし
};

type Round = {
  id: string;
  topic: string;
  setterId: string;
  answers: Answer[];
  result: 'unopened' | 'opened';
  unanimous: boolean | null;
};

type Answer = {
  userId: string;
  value: string;
  submittedAt: number;
};
```

## データ型と API 契約
共通型（docs に準拠）: User, Room, RoomSettings, Round, Answer

API 例:
- POST `/rooms` → ルーム作成
  - req: `{ gmId: string }`
  - res: `{ roomId: string /* 4桁 */, gmToken: string }`
- POST `/rooms/:id/join`
  - req: `{ user: User }`
  - res: `{ room: Room }`
- GET `/rooms/:id` → `{ room: Room }`
- POST `/rooms/:id/start` → GM 専用（`gmToken`）
- POST `/rooms/:id/round` → `{ gmToken, topic, setterId }`
- POST `/rooms/:id/answer` → `{ userId, value }`
- POST `/rooms/:id/open` → GM 専用
- POST `/rooms/:id/result` → `{ gmToken, unanimous }`
- WS `/ws/:id` → 参加で現状態即時送信、以後更新を配信

認可:
- GM 操作は `gmToken` 必須（ルーム作成時に払い出し、LocalStorage に保持）

エラー:
- 404: ルーム不在 / 410: 終了 / 409: 状態不正 / 400: バリデーション